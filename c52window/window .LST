C51 COMPILER V9.53.0.0   WINDOW_                                                           06/29/2017 22:59:53 PAGE 1   


C51 COMPILER V9.53.0.0, COMPILATION OF MODULE WINDOW_
OBJECT MODULE PLACED IN window .OBJ
COMPILER INVOKED BY: d:\Keil_v5\C51\BIN\C51.EXE window .c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1                                                                                 /***************   writer:shopping.w   ******************/
   2          #include <reg52.h>//库函数
   3          #include <dht11.h> //库函数//如果 实物 打开
   4          #include <adc0832.h> //AD转换库函数
   5          
   6          #define uchar unsigned char//宏定意
   7          #define uint  unsigned int//宏定意
   8          #define ulong unsigned long //宏定意
   9          
  10          sbit rs=P2^0;//LCD 1602 引脚定意    
  11          sbit rd=P2^1;//LCD 1602 引脚定意    
  12          sbit lcden=P2^2;//LCD 1602 引脚定意
  13          
  14          sbit menu=P2^5; //主功能键  
  15          sbit add=P2^4;//加键    
  16          sbit dec=P2^3;// 减键
  17          sbit open=P2^6;// 手动 开
  18          sbit close=P2^7;// 手动 关  
  19          sbit IR=P3^5; //红外感 应
  20          sbit BEEP=P3^1;// 报警
  21          
  22          
  23          
  24          #define MOTORSTEP P1      //宏定义，定义P1口为步进电机驱动端口
  25          
  26          uchar  dsflj,kval,lofl,menusw,con,befl,zhenfl,fanfl,brigfl;// 各种变量标记 正返转标记
  27          uint sudu,dwbrigfl,humfl;  //电机速度 //光度下限/湿度标记
  28          uchar count0,second,zhenzhuan,fanzhuan,timeflg,opensw,closesw,keysw;//时钟变量 正反转 变量  
  29          uint adc0,adc1;
  30          uint upbrig,dwbrig,kwbrig,uphum,uptemp,upsmo; // 下限 亮度 上限湿度// 上限温度
  31          
  32          uint hour,minit,secon,DSdat,VAldat ,time;//时钟变量
  33          
  34          uint ONhour,ONminit,ONsecon; // 开窗时间变量
  35          uint OFhour,OFminit,OFsecon; // 关窗时间变量
  36          uchar   U8T_data_H,U8RH_data_H;
  37          
  38          
  39          #define Imax 14000    //此处为晶振为11.0592时的取值, 
  40          #define Imin 8000    //如用其它频率的晶振时,
  41          #define Inum1 1450    //要改变相应的取值。
  42          #define Inum2 700 
  43          #define Inum3 3000 
  44          
  45          uchar f=0;
  46          uchar Im[4]={0x00,0x00,0x00,0x00}; // 遥控码存储空间
  47          uchar show[2]={0,0};  // 变量申明
  48          ulong m,Tc;   // 变量申明
  49          uchar IrOK;   // 变量申明
  50          
  51          
  52          
  53          void delay(uint z);// 开窗时间变量
  54          
  55          void write_rvalue(); // 显示函数
C51 COMPILER V9.53.0.0   WINDOW_                                                           06/29/2017 22:59:53 PAGE 2   

  56          //**************以下是各种字幕提示语数组************************
  57          uchar code logo1[]= "Welcome to use  ";
  58          uchar code logo2[]="window   system  ";
  59          uchar code logo3[]="S=253T=85oCU=85%";
  60          uchar code logo4[]="Br=     12:00:00 ";
  61          uchar code logo5[]="window open      ";
  62          uchar code logo6[]="window close     ";
  63          uchar code logo7[]="GWbrig=    LUX  ";
  64          uchar code logo8[]="UP-Hum=    %    ";
  65          uchar code logo9[]="Please input...  ";
  66          uchar code logo10[]="Please wait...  ";
  67          uchar code logo11[]="UP-TEM=    oC   ";
  68          uchar code logo12[]="SEtime  12:00:00";
  69          uchar code logo13[]="ONtime  12:00:00";
  70          uchar code logo14[]="OFtime  12:00:00";
  71          uchar code logo15[]="UP-SMO=         ";
  72          uchar code logo16[]="KWbrig=    LUX  ";
  73          
  74          
  75          
  76          void delaymoto()          //步进电机每一步间延迟函数
  77          {   
  78   1        uint y=sudu;
  79   1        while(y--);
  80   1      }
  81          
  82          
  83          
  84          uchar code FFW[]={0x01,0x03,0x02,0x06,0x04,0x0c,0x08,0x09}; //步进电机驱动值数组
  85          
  86          uchar code REV[]={0x09,0x08,0x0c,0x04,0x06,0x02,0x03,0x01}; //步进电机驱动值数组
  87          
  88          
  89          
  90          xdata num1 [4] =    {0x00,0x00,0x00,0x00,};       
  91          xdata num2 [4] =    {0x00,0x00,0x00,0x00,};      
  92          xdata num3 [4] =    {0x00,0x00,0x00,0x00,};      
  93          xdata num4 [4] =    {0x00,0x00,0x00,0x00,}; // AD转换变量组组
  94          xdata num5 [4] =    {0x00,0x00,0x00,0x00,}; // AD转换变量组组
  95          
  96          
  97          
  98          
  99          void delaylog(uint z)//延时函数
 100          {
 101   1        uint x,y;
 102   1        for(x=z;x>0;x--)
 103   1          for(y=500;y>0;y--);
 104   1      }
 105          
 106          
 107          
 108          
 109          void delay(uint z)//延时函数
 110          {
 111   1        uint x,y;
 112   1        for(x=z;x>0;x--)
 113   1          for(y=10;y>0;y--);
 114   1      }
 115          
 116          
 117          
C51 COMPILER V9.53.0.0   WINDOW_                                                           06/29/2017 22:59:53 PAGE 3   

 118          
 119          
 120          
 121            void SETP_MOTOR_FFW()  //反转
 122          {
 123   1             uint i=0;
 124   1      
 125   1          for(i=0;i<8;i++) //8步一个循环
 126   1            {
 127   2              MOTORSTEP=FFW[i]; //取值赋给P1驱动口
 128   2              delaymoto(); 
 129   2            }
 130   1      
 131   1       }
 132          
 133          void SETP_MOTOR_REV()  //正转
 134          {
 135   1       
 136   1      
 137   1          uint i=0;
 138   1      
 139   1          for(i=0;i<8;i++) //8步一个循环
 140   1            {
 141   2              MOTORSTEP=REV[i]; //取值赋给P1驱动口
 142   2              delaymoto(); 
 143   2            }
 144   1      
 145   1      }
 146          
 147          void write_com(uchar com) //LCD 1602 写指令
 148          {
 149   1        rs=0;
 150   1        lcden=0;
 151   1        P0=com;
 152   1        delay(5);
 153   1        lcden=1;
 154   1        delay(5);
 155   1        lcden=0;  
 156   1      }
 157          
 158          void write_date(uchar date)//LCD 1602 写数据
 159          {
 160   1        rs=1;
 161   1        lcden=0;
 162   1        P0=date;
 163   1        delay(5);
 164   1        lcden=1;
 165   1        delay(5);
 166   1        lcden=0;  
 167   1      }
 168          
 169          void init1602()//LCD 1602 初始化
 170          {
 171   1        uchar num;
 172   1        rd=0;
 173   1        lcden=0;
 174   1        write_com(0x38);
 175   1        write_com(0x0c);
 176   1        write_com(0x06);
 177   1        write_com(0x01);
 178   1        write_com(0x80);
 179   1      
C51 COMPILER V9.53.0.0   WINDOW_                                                           06/29/2017 22:59:53 PAGE 4   

 180   1      
 181   1      
 182   1         
 183   1         
 184   1        for(num=0;num<16;num++)
 185   1          {
 186   2            write_date(logo1[num]);//开机字幕
 187   2            delay(2);
 188   2          }
 189   1      
 190   1        
 191   1         
 192   1      
 193   1        write_com(0x80+0x40);
 194   1        for(num=0;num<16;num++)
 195   1          {
 196   2            write_date(logo2[num]); //开机字幕
 197   2            delay(2);
 198   2          }
 199   1      
 200   1          delaylog(200);
 201   1       //***************************************************
 202   1      
 203   1            write_com(0x80);
 204   1      
 205   1              for(num=0;num<16;num++) //开机字幕
 206   1          {
 207   2            write_date(logo6[num]);
 208   2            delay(2);
 209   2          }
 210   1      
 211   1        
 212   1         
 213   1      
 214   1        write_com(0x80+0x40);
 215   1        for(num=0;num<16;num++)
 216   1          {
 217   2            write_date(logo10[num]);//开机字幕
 218   2            delay(2);
 219   2          }
 220   1      
 221   1      
 222   1      }
 223          
 224          
 225          
 226          
 227          
 228          
 229          
 230          
 231          
 232          
 233          
 234          
 235          
 236          void write_sfm() // 拆分 个位 十位显示
 237          
 238          { uchar shi ,ge;
 239   1      
 240   1        shi=DSdat/10;
 241   1        ge=DSdat%10;
C51 COMPILER V9.53.0.0   WINDOW_                                                           06/29/2017 22:59:53 PAGE 5   

 242   1        
 243   1        write_date(0x30+shi);
 244   1        write_date(0x30+ge);  
 245   1      
 246   1      
 247   1      }
 248          
 249          
 250          
 251          
 252          
 253          
 254          
 255          void keyscn()//按键扫描函数
 256          {
 257   1        uchar num; //局部变量
 258   1      
 259   1       if(keysw==1)
 260   1       {
 261   2       if(opensw==1)
 262   2      {
 263   3      if(open==0)  // 手动开窗
 264   3        {
 265   4              write_com(0x80);
 266   4      
 267   4              for(num=0;num<16;num++)//显示提示语
 268   4          {
 269   5            write_date(logo5[num]);
 270   5            delay(2);
 271   5          }
 272   4      
 273   4      
 274   4            write_com(0x80+0x40);
 275   4      
 276   4              for(num=0;num<16;num++)//显示提示语
 277   4          {
 278   5            write_date(logo10[num]);
 279   5            delay(2);
 280   5          }
 281   4      
 282   4      
 283   4      
 284   4           
 285   4           
 286   4           closesw=1; // 已打开标记
 287   4             delay(10);
 288   4          if(open==0)
 289   4          {
 290   5          while(!open);
 291   5          zhenzhuan=1;// 正转 开启
 292   5          fanzhuan=0;  // 返转关闭
 293   5          second=0;// 秒清零 步进电机 会停
 294   5          keysw=0;
 295   5          menusw=0;
 296   5           }
 297   4               
 298   4          } 
 299   3         
 300   3       }
 301   2      
 302   2        if(closesw==1)//如果窗户是打开的
 303   2        {
C51 COMPILER V9.53.0.0   WINDOW_                                                           06/29/2017 22:59:53 PAGE 6   

 304   3       if(close==0)//按下手动开
 305   3        {
 306   4      
 307   4           write_com(0x80);
 308   4      
 309   4              for(num=0;num<16;num++)//显示提示语
 310   4          {
 311   5            write_date(logo6[num]);
 312   5            delay(2);
 313   5          }
 314   4      
 315   4              write_com(0x80+0x40);
 316   4      
 317   4              for(num=0;num<16;num++)
 318   4          {
 319   5            write_date(logo10[num]);//显示提示语
 320   5            delay(2);
 321   5          }
 322   4      
 323   4      
 324   4           
 325   4             delay(10);
 326   4          if(close==0)
 327   4          {
 328   5          while(!close);
 329   5          zhenzhuan=0;  //正转关
 330   5          fanzhuan=1; // 反转 开启
 331   5          second=0;   // 定时清零
 332   5          keysw=0; // 标记请零
 333   5           menusw=0;
 334   5           }
 335   4               
 336   4          } 
 337   3      
 338   3       }
 339   2      
 340   2       }
 341   1      
 342   1      
 343   1       if(menusw==1)//如果窗户运行完毕
 344   1      {
 345   2        if(menu==0)// 如果主功能键按下
 346   2        {
 347   3      
 348   3          lofl=1; //字幕载入
 349   3      
 350   3          
 351   3      
 352   3             delay(10); //延时消抖动
 353   3          if(menu==0)
 354   3          {
 355   4          while(!menu);//松手检测
 356   4           dsflj=0;// 关主页显示
 357   4           kval++; // 按键变量++
 358   4           keysw=0;//不允许手动 开窗  和关窗
 359   4           }
 360   3           } 
 361   2      
 362   2           
 363   2      
 364   2      //*************************************************************************8
 365   2      
C51 COMPILER V9.53.0.0   WINDOW_                                                           06/29/2017 22:59:53 PAGE 7   

 366   2        if(kval==1)  // 如果变量==1  进入时间设定
 367   2      
 368   2       {
 369   3        
 370   3        if(lofl==1)
 371   3        {
 372   4       write_com(0x80);
 373   4      
 374   4              for(num=0;num<16;num++)
 375   4          {
 376   5            write_date(logo12[num]);//显示提示语
 377   5            delay(2);
 378   5      
 379   5          
 380   5          }
 381   4      
 382   4      
 383   4      
 384   4           write_com(0x80+0x40);
 385   4      
 386   4              for(num=0;num<16;num++) //显示提示语
 387   4          {
 388   5            write_date(logo9[num]);
 389   5            delay(2);
 390   5      
 391   5            lofl=0;
 392   5          }
 393   4      
 394   4      
 395   4      
 396   4      
 397   4            DSdat=hour;
 398   4              write_com(0x80+8);  // 刷新 设定时间
 399   4          write_sfm();
 400   4      
 401   4      
 402   4             
 403   4          DSdat=minit;
 404   4            write_com(0x80+11);// 刷新 设定时间
 405   4            write_sfm();
 406   4      
 407   4           DSdat=secon;
 408   4          write_com(0x80+14); // 刷新 设定时间
 409   4          write_sfm();
 410   4      
 411   4      
 412   4      
 413   4      }
 414   3      
 415   3      
 416   3       }
 417   2      
 418   2      
 419   2      
 420   2      //uint hour,minit,secon;
 421   2      
 422   2         if(kval==2)//如果变量=2 进入小时设定
 423   2      
 424   2       {DSdat=hour;   // 刷新显示小时
 425   3        
 426   3        
 427   3        write_com(0x40+0x40+8);// 显示坐标
C51 COMPILER V9.53.0.0   WINDOW_                                                           06/29/2017 22:59:53 PAGE 8   

 428   3        write_com(0x0e);
 429   3                   // 开关标
 430   3      
 431   3        
 432   3      if(add==0)// 如果加键按下
 433   3      
 434   3      {
 435   4      
 436   4      while(!add); // 松手检测
 437   4       
 438   4      
 439   4      hour++; //小时++
 440   4      
 441   4      DSdat=hour; //送显示
 442   4      write_sfm(); // 拆分
 443   4      if(hour==24)  //
 444   4      {hour=0;}
 445   4      
 446   4      
 447   4      
 448   4      }
 449   3      
 450   3      
 451   3      
 452   3      
 453   3      
 454   3       if( dec==0) // 如果减键按下
 455   3      
 456   3      {
 457   4      
 458   4      while(! dec);// 松手检测
 459   4       
 460   4      
 461   4      hour--;  //小时--
 462   4      DSdat=hour;
 463   4      write_sfm(); //拆分限位
 464   4      if(hour==0)//限位
 465   4      {hour=23;}
 466   4      
 467   4      
 468   4      
 469   4      
 470   4      }
 471   3      
 472   3       }
 473   2      
 474   2      
 475   2      
 476   2      
 477   2      
 478   2      
 479   2      
 480   2       //**************************以下时 分钟设 定 秒钟设定 和上面小时一样
 481   2       //只是就量不一样 不作注释*******************************************
 482   2       //********************************************************************
 483   2       
 484   2         if(kval==3)
 485   2      
 486   2       {
 487   3      
 488   3      
 489   3      DSdat=minit;
C51 COMPILER V9.53.0.0   WINDOW_                                                           06/29/2017 22:59:53 PAGE 9   

 490   3      
 491   3        write_com(0x40+0x40+11);
 492   3        write_com(0x0e);
 493   3      
 494   3      
 495   3        
 496   3      if(add==0)
 497   3      
 498   3      {
 499   4      
 500   4      while(!add);
 501   4       
 502   4      
 503   4      minit++;
 504   4      
 505   4      DSdat=minit;
 506   4      write_sfm();
 507   4      if(minit==60)
 508   4      {minit=0;}
 509   4      
 510   4      
 511   4      
 512   4      }
 513   3      
 514   3      
 515   3      
 516   3      
 517   3      
 518   3       if( dec==0)
 519   3      
 520   3      {
 521   4      
 522   4      while(! dec);
 523   4       
 524   4      
 525   4      minit--;
 526   4      
 527   4      DSdat=minit;
 528   4      write_sfm();
 529   4      if(minit==0)
 530   4      {minit=59;}
 531   4      
 532   4      
 533   4      
 534   4      }
 535   3      
 536   3       }
 537   2      
 538   2      
 539   2      
 540   2      
 541   2      
 542   2      
 543   2      
 544   2      
 545   2      
 546   2      
 547   2      
 548   2      
 549   2      
 550   2       
 551   2         if(kval==4)
C51 COMPILER V9.53.0.0   WINDOW_                                                           06/29/2017 22:59:53 PAGE 10  

 552   2      
 553   2       { 
 554   3       
 555   3       
 556   3       DSdat=secon;
 557   3        
 558   3        write_com(0x40+0x40+14);
 559   3        write_com(0x0e);
 560   3      
 561   3      
 562   3        
 563   3      if(add==0)
 564   3      
 565   3      {
 566   4      
 567   4      while(!add);
 568   4       
 569   4      
 570   4      secon++;
 571   4      
 572   4      DSdat=secon;
 573   4      write_sfm();
 574   4      if(secon==60)
 575   4      {secon=0;}
 576   4      
 577   4      
 578   4      
 579   4      }
 580   3      
 581   3      
 582   3      
 583   3      
 584   3      
 585   3       if( dec==0)
 586   3      
 587   3      {
 588   4      
 589   4      while(! dec);
 590   4       
 591   4      
 592   4      secon--;
 593   4      
 594   4      DSdat=secon;
 595   4      write_sfm();
 596   4      if(secon==0)
 597   4      {secon=59;}
 598   4      
 599   4      
 600   4      
 601   4      }
 602   3      
 603   3       }
 604   2      
 605   2      
 606   2      //uint ONhour,ONminit,ONsecon;
 607   2      //uint OFhour,OFminit,OFsecon;
 608   2      
 609   2       
 610   2      
 611   2       //**************************以下 开窗时  小时 分钟设 定 秒钟设定 和上面小时一样
 612   2       //只是就量不一样 不作注释*******************************************
 613   2       //**************
C51 COMPILER V9.53.0.0   WINDOW_                                                           06/29/2017 22:59:53 PAGE 11  

 614   2      
 615   2      //*************************************设定开时****************************************
 616   2       
 617   2         if(kval==5)
 618   2      
 619   2       {
 620   3        
 621   3         if(lofl==1)
 622   3        {
 623   4       write_com(0x80);
 624   4      
 625   4              for(num=0;num<16;num++)
 626   4          {
 627   5            write_date(logo13[num]);
 628   5            delay(2);
 629   5      
 630   5          
 631   5          }
 632   4      
 633   4      
 634   4      
 635   4           write_com(0x80+0x40);
 636   4      
 637   4              for(num=0;num<16;num++)
 638   4          {
 639   5            write_date(logo9[num]);
 640   5            delay(2);
 641   5      
 642   5          
 643   5          }
 644   4      
 645   4      
 646   4      
 647   4          DSdat=ONhour;
 648   4              write_com(0x80+8);
 649   4          write_sfm();
 650   4      
 651   4      
 652   4            DSdat=ONminit;
 653   4            write_com(0x80+11);
 654   4            write_sfm();
 655   4      
 656   4      
 657   4             DSdat=ONsecon;
 658   4          write_com(0x80+14);
 659   4          write_sfm();
 660   4      
 661   4        
 662   4          
 663   4      
 664   4      
 665   4            lofl=0;
 666   4      
 667   4      
 668   4      
 669   4      
 670   4      
 671   4      }
 672   3      
 673   3      
 674   3      
 675   3      
C51 COMPILER V9.53.0.0   WINDOW_                                                           06/29/2017 22:59:53 PAGE 12  

 676   3      
 677   3      }
 678   2      
 679   2       
 680   2      
 681   2      
 682   2        if(kval==6)
 683   2      
 684   2       {
 685   3        
 686   3        write_com(0x80+0x08);
 687   3        write_com(0x0e);
 688   3      
 689   3      
 690   3        
 691   3      if(add==0)
 692   3      
 693   3      {
 694   4      
 695   4      while(!add);
 696   4       
 697   4      
 698   4      ONhour++;
 699   4      
 700   4      DSdat=ONhour;
 701   4      write_sfm();
 702   4      if(ONhour==24)
 703   4      {ONhour=0;}
 704   4      
 705   4      
 706   4      
 707   4      }
 708   3      
 709   3      
 710   3      
 711   3      
 712   3      
 713   3       if( dec==0)
 714   3      
 715   3      {
 716   4      
 717   4      while(! dec);
 718   4       
 719   4      
 720   4      ONhour--;
 721   4      
 722   4      DSdat=ONhour;
 723   4      write_sfm();
 724   4      if(ONhour==0)
 725   4      {ONhour=23;}
 726   4      
 727   4      
 728   4      
 729   4      }
 730   3      
 731   3       }
 732   2      
 733   2      
 734   2      
 735   2      
 736   2      
 737   2      
C51 COMPILER V9.53.0.0   WINDOW_                                                           06/29/2017 22:59:53 PAGE 13  

 738   2         if(kval==7)
 739   2      
 740   2       {
 741   3        
 742   3        write_com(0x40+0x40+11);
 743   3        write_com(0x0e);
 744   3      
 745   3      
 746   3        
 747   3      if(add==0)
 748   3      
 749   3      {
 750   4      
 751   4      while(!add);
 752   4       
 753   4      
 754   4      ONminit++;
 755   4      
 756   4      DSdat=ONminit;
 757   4      write_sfm();
 758   4      if(ONminit==60)
 759   4      {ONminit=0;}
 760   4      
 761   4      
 762   4      
 763   4      }
 764   3      
 765   3      
 766   3      
 767   3      
 768   3      
 769   3       if( dec==0)
 770   3      
 771   3      {
 772   4      
 773   4      while(! dec);
 774   4       
 775   4      
 776   4      ONminit--;
 777   4      
 778   4      DSdat=ONminit;
 779   4      write_sfm();
 780   4      if(ONminit==0)
 781   4      {ONminit=59;}
 782   4      
 783   4      
 784   4      
 785   4      }
 786   3      
 787   3       }
 788   2      
 789   2      
 790   2      
 791   2      
 792   2      
 793   2      
 794   2        if(kval==8)
 795   2      
 796   2       {
 797   3        
 798   3        write_com(0x40+0x40+14);
 799   3        write_com(0x0e);
C51 COMPILER V9.53.0.0   WINDOW_                                                           06/29/2017 22:59:53 PAGE 14  

 800   3      
 801   3      
 802   3        
 803   3      if(add==0)
 804   3      
 805   3      {
 806   4      
 807   4      while(!add);
 808   4       
 809   4      
 810   4      ONsecon++;
 811   4      
 812   4      DSdat=ONsecon;
 813   4      write_sfm();
 814   4      if(ONsecon==60)
 815   4      {ONsecon=0;}
 816   4      
 817   4      
 818   4      
 819   4      }
 820   3      
 821   3      
 822   3      
 823   3      
 824   3      
 825   3       if( dec==0)
 826   3      
 827   3      {
 828   4      
 829   4      while(! dec);
 830   4       
 831   4      
 832   4      ONsecon--;
 833   4      
 834   4      DSdat=ONsecon;
 835   4      write_sfm();
 836   4      if(ONsecon==0)
 837   4      {ONsecon=59;}
 838   4      
 839   4      
 840   4      
 841   4      }
 842   3      
 843   3       }
 844   2       
 845   2      
 846   2       //**************************以下 关窗时  小时 分钟设 定 秒钟设定 和上面小时一样
 847   2       //只是就量不一样 不作注释*******************************************
 848   2       //**************
 849   2      
 850   2      
 851   2      //**************************************设定关时间**************************************
 852   2        
 853   2        
 854   2       
 855   2         if(kval==9)
 856   2      
 857   2       {
 858   3        
 859   3         if(lofl==1)
 860   3        {
 861   4       write_com(0x80);
C51 COMPILER V9.53.0.0   WINDOW_                                                           06/29/2017 22:59:53 PAGE 15  

 862   4      
 863   4              for(num=0;num<16;num++)
 864   4          {
 865   5            write_date(logo14[num]);
 866   5            delay(2);
 867   5      
 868   5          
 869   5          }
 870   4      
 871   4      
 872   4      
 873   4           write_com(0x80+0x40);
 874   4      
 875   4              for(num=0;num<16;num++)
 876   4          {
 877   5            write_date(logo9[num]);
 878   5            delay(2);
 879   5      
 880   5            lofl=0;
 881   5          }
 882   4      
 883   4      
 884   4          DSdat=OFhour;
 885   4              write_com(0x80+8);
 886   4          write_sfm();
 887   4      
 888   4      
 889   4          DSdat=OFminit;
 890   4            write_com(0x80+11);
 891   4            write_sfm();
 892   4      
 893   4          
 894   4      
 895   4              DSdat=OFsecon;
 896   4          write_com(0x80+14);
 897   4          write_sfm();
 898   4      
 899   4          
 900   4      
 901   4      }
 902   3      
 903   3      
 904   3      
 905   3      
 906   3      
 907   3      } 
 908   2        
 909   2        
 910   2        
 911   2        
 912   2        
 913   2        
 914   2        
 915   2        
 916   2          
 917   2       if(kval==10)
 918   2      
 919   2       {
 920   3        
 921   3        write_com(0x80+0x08);
 922   3        write_com(0x0e);
 923   3      
C51 COMPILER V9.53.0.0   WINDOW_                                                           06/29/2017 22:59:53 PAGE 16  

 924   3      
 925   3        
 926   3      if(add==0)
 927   3      
 928   3      {
 929   4      
 930   4      while(!add);
 931   4       
 932   4      
 933   4      OFhour++;
 934   4      
 935   4      DSdat=OFhour;
 936   4      write_sfm();
 937   4      if(OFhour==24)
 938   4      {OFhour=0;}
 939   4      
 940   4      
 941   4      
 942   4      }
 943   3      
 944   3      
 945   3      
 946   3      
 947   3      
 948   3       if( dec==0)
 949   3      
 950   3      {
 951   4      
 952   4      while(! dec);
 953   4       
 954   4      
 955   4      OFhour--;
 956   4      
 957   4      DSdat=OFhour;
 958   4      write_sfm();
 959   4      if(OFhour==0)
 960   4      {OFhour=23;}
 961   4      
 962   4      
 963   4      
 964   4      }
 965   3      
 966   3       }
 967   2      
 968   2      
 969   2      
 970   2      
 971   2      
 972   2      
 973   2         if(kval==11)
 974   2      
 975   2       {
 976   3        
 977   3        write_com(0x40+0x40+11);
 978   3        write_com(0x0e);
 979   3      
 980   3      
 981   3        
 982   3      if(add==0)
 983   3      
 984   3      {
 985   4      
C51 COMPILER V9.53.0.0   WINDOW_                                                           06/29/2017 22:59:53 PAGE 17  

 986   4      while(!add);
 987   4       
 988   4      
 989   4      OFminit++;
 990   4      
 991   4      DSdat=OFminit;
 992   4      write_sfm();
 993   4      if(OFminit==60)
 994   4      {OFminit=0;}
 995   4      
 996   4      
 997   4      
 998   4      }
 999   3      
1000   3      
1001   3      
1002   3      
1003   3      
1004   3       if( dec==0)
1005   3      
1006   3      {
1007   4      
1008   4      while(! dec);
1009   4       
1010   4      
1011   4      OFminit--;
1012   4      
1013   4      DSdat=OFminit;
1014   4      write_sfm();
1015   4      if(OFminit==0)
1016   4      {OFminit=59;}
1017   4      
1018   4      
1019   4      
1020   4      }
1021   3      
1022   3       }
1023   2      
1024   2      
1025   2      
1026   2      
1027   2      
1028   2      
1029   2      
1030   2      
1031   2      
1032   2      
1033   2      
1034   2      
1035   2        if(kval==12)
1036   2      
1037   2       {
1038   3        
1039   3        write_com(0x40+0x40+14);
1040   3        write_com(0x0e);
1041   3      
1042   3      
1043   3        
1044   3      if(add==0)
1045   3      
1046   3      {
1047   4      
C51 COMPILER V9.53.0.0   WINDOW_                                                           06/29/2017 22:59:53 PAGE 18  

1048   4      while(!add);
1049   4       
1050   4      
1051   4      OFsecon++;
1052   4      
1053   4      DSdat=OFsecon;
1054   4      write_sfm();
1055   4      if(OFsecon==60)
1056   4      {OFsecon=0;}
1057   4      
1058   4      
1059   4      
1060   4      }
1061   3      
1062   3      
1063   3      
1064   3      
1065   3      
1066   3       if( dec==0)
1067   3      
1068   3      {
1069   4      
1070   4      while(! dec);
1071   4       
1072   4      
1073   4      OFsecon--;
1074   4      
1075   4      DSdat=OFsecon;
1076   4      write_sfm();
1077   4      if(OFsecon==0)
1078   4      {OFsecon=59;}
1079   4      
1080   4      
1081   4      
1082   4      }
1083   3      
1084   3       }
1085   2      
1086   2      
1087   2      
1088   2      
1089   2      
1090   2      
1091   2      
1092   2      
1093   2      
1094   2      
1095   2       
1096   2      
1097   2       //**************************以下 亮度会上设定  和上面小时一样
1098   2       //只是就量不一样 不作注释*******************************************
1099   2       //**************
1100   2      
1101   2      
1102   2        //********************************设定环境参数************************************
1103   2       
1104   2        if(kval==13)
1105   2      
1106   2       {
1107   3      
1108   3         write_com(0x0c);
1109   3      
C51 COMPILER V9.53.0.0   WINDOW_                                                           06/29/2017 22:59:53 PAGE 19  

1110   3         num4[4]=dwbrig;
1111   3         write_rvalue();
1112   3        if(lofl==1)
1113   3        {
1114   4       write_com(0x80);
1115   4      
1116   4              for(num=0;num<16;num++)
1117   4          {
1118   5            write_date(logo7[num]);
1119   5            delay(2);
1120   5      
1121   5          
1122   5          }
1123   4      
1124   4      
1125   4      
1126   4           write_com(0x80+0x40);
1127   4      
1128   4              for(num=0;num<16;num++)
1129   4          {
1130   5            write_date(logo9[num]);
1131   5            delay(2);
1132   5      
1133   5            lofl=0;
1134   5          }
1135   4      
1136   4      
1137   4      }
1138   3      
1139   3      
1140   3          if(add==0)  
1141   3        {
1142   4           delay(10);
1143   4      
1144   4            
1145   4          if(add==0)
1146   4          {
1147   5          while(!add);                            
1148   5           dwbrig++;
1149   5           num4[4]=dwbrig;
1150   5           write_rvalue();
1151   5      
1152   5      
1153   5               if(dwbrig==250)
1154   5                {dwbrig=0;}
1155   5      
1156   5      
1157   5           }
1158   4           } 
1159   3      
1160   3      
1161   3      
1162   3          if(dec==0)  
1163   3        {
1164   4           delay(10);
1165   4      
1166   4            
1167   4          if(dec==0)
1168   4          {
1169   5          while(!dec);                            
1170   5           dwbrig--;
1171   5           num4[4]=dwbrig;
C51 COMPILER V9.53.0.0   WINDOW_                                                           06/29/2017 22:59:53 PAGE 20  

1172   5           write_rvalue();
1173   5      
1174   5      
1175   5               if(dwbrig==0)
1176   5                {dwbrig=250;}
1177   5      
1178   5      
1179   5           }
1180   4           } 
1181   3      
1182   3      
1183   3       }
1184   2      
1185   2      
1186   2      
1187   2      
1188   2      
1189   2      
1190   2      
1191   2      
1192   2      
1193   2      
1194   2      
1195   2      //*********************************************************************
1196   2      
1197   2      
1198   2         //********************************设定环境参数************************************
1199   2       
1200   2        if(kval==14)
1201   2      
1202   2       {
1203   3      
1204   3         write_com(0x0c);
1205   3      
1206   3         num4[4]=kwbrig;
1207   3         write_rvalue();
1208   3        if(lofl==1)
1209   3        {
1210   4       write_com(0x80);
1211   4      
1212   4              for(num=0;num<16;num++)
1213   4          {
1214   5            write_date(logo16[num]);
1215   5            delay(2);
1216   5      
1217   5          
1218   5          }
1219   4      
1220   4      
1221   4      
1222   4           write_com(0x80+0x40);
1223   4      
1224   4              for(num=0;num<16;num++)
1225   4          {
1226   5            write_date(logo9[num]);
1227   5            delay(2);
1228   5      
1229   5            lofl=0;
1230   5          }
1231   4      
1232   4      
1233   4      }
C51 COMPILER V9.53.0.0   WINDOW_                                                           06/29/2017 22:59:53 PAGE 21  

1234   3      
1235   3      
1236   3          if(add==0)  
1237   3        {
1238   4           delay(10);
1239   4      
1240   4            
1241   4          if(add==0)
1242   4          {
1243   5          while(!add);                            
1244   5           kwbrig++;
1245   5           num4[4]=kwbrig;
1246   5           write_rvalue();
1247   5      
1248   5      
1249   5               if(kwbrig==250)
1250   5                {kwbrig=0;}
1251   5      
1252   5      
1253   5           }
1254   4           } 
1255   3      
1256   3      
1257   3      
1258   3          if(dec==0)  
1259   3        {
1260   4           delay(10);
1261   4      
1262   4            
1263   4          if(dec==0)
1264   4          {
1265   5          while(!dec);                            
1266   5           kwbrig--;
1267   5           num4[4]=kwbrig;
1268   5           write_rvalue();
1269   5      
1270   5      
1271   5               if(kwbrig==0)
1272   5                {kwbrig=250;}
1273   5      
1274   5      
1275   5           }
1276   4           } 
1277   3      
1278   3      
1279   3       }
1280   2      
1281   2      
1282   2      
1283   2      
1284   2      
1285   2      
1286   2      
1287   2      
1288   2      
1289   2      
1290   2      
1291   2      
1292   2      
1293   2       
1294   2       //**************************以下 湿度会上设定  和上面小时一样
1295   2       //只是就量不一样 不作注释*******************************************
C51 COMPILER V9.53.0.0   WINDOW_                                                           06/29/2017 22:59:53 PAGE 22  

1296   2       //**************   
1297   2       if(kval==15)
1298   2      
1299   2       {
1300   3         num4[4]=uphum;
1301   3         write_rvalue();
1302   3        if(lofl==1)
1303   3        {
1304   4       write_com(0x80);
1305   4      
1306   4              for(num=0;num<16;num++)
1307   4          {
1308   5            write_date(logo8[num]);
1309   5            delay(2);
1310   5      
1311   5          
1312   5          }
1313   4      
1314   4      
1315   4      
1316   4           write_com(0x80+0x40);
1317   4      
1318   4              for(num=0;num<16;num++)
1319   4          {
1320   5            write_date(logo9[num]);
1321   5            delay(2);
1322   5      
1323   5            lofl=0;
1324   5          }
1325   4      
1326   4      
1327   4      }
1328   3      
1329   3      
1330   3           
1331   3      
1332   3          
1333   3      
1334   3      
1335   3      
1336   3      
1337   3          if(add==0)  
1338   3        {
1339   4           delay(10);
1340   4      
1341   4            
1342   4          if(add==0)
1343   4          {
1344   5          while(!add);                            
1345   5           uphum++;
1346   5           num4[4]=uphum;
1347   5           write_rvalue();
1348   5      
1349   5      
1350   5               if(uphum==100)
1351   5                {uphum=0;}
1352   5      
1353   5      
1354   5           }
1355   4           } 
1356   3      
1357   3      
C51 COMPILER V9.53.0.0   WINDOW_                                                           06/29/2017 22:59:53 PAGE 23  

1358   3      
1359   3          if(dec==0)  
1360   3        {
1361   4           delay(10);
1362   4      
1363   4            
1364   4          if(dec==0)
1365   4          {
1366   5          while(!dec);                            
1367   5           uphum--;
1368   5           num4[4]=uphum;
1369   5           write_rvalue();
1370   5      
1371   5      
1372   5               if(uphum==0)
1373   5                {uphum=100;}
1374   5      
1375   5      
1376   5           }
1377   4           } 
1378   3      
1379   3      
1380   3       }
1381   2      
1382   2      
1383   2      
1384   2      
1385   2      
1386   2       
1387   2       //**************************以下 温度度会上设定  和上面小时一样
1388   2       //只是就量不一样 不作注释*******************************************
1389   2       //**************       
1390   2       if(kval==16)
1391   2      
1392   2       {
1393   3         num4[4]=uptemp;
1394   3         write_rvalue();
1395   3        if(lofl==1)
1396   3        {
1397   4       write_com(0x80);
1398   4      
1399   4              for(num=0;num<16;num++)
1400   4          {
1401   5            write_date(logo11[num]);
1402   5            delay(2);
1403   5      
1404   5          
1405   5          }
1406   4      
1407   4      
1408   4      
1409   4           write_com(0x80+0x40);
1410   4      
1411   4              for(num=0;num<16;num++)
1412   4          {
1413   5            write_date(logo9[num]);
1414   5            delay(2);
1415   5      
1416   5            lofl=0;
1417   5          }
1418   4      
1419   4      
C51 COMPILER V9.53.0.0   WINDOW_                                                           06/29/2017 22:59:53 PAGE 24  

1420   4      }
1421   3      
1422   3      
1423   3           
1424   3      
1425   3          
1426   3      
1427   3      
1428   3      
1429   3      
1430   3          if(add==0)  
1431   3        {
1432   4           delay(10);
1433   4      
1434   4            
1435   4          if(add==0)
1436   4          {
1437   5          while(!add);                            
1438   5           uptemp++;
1439   5           num4[4]=uptemp;
1440   5           write_rvalue();
1441   5      
1442   5      
1443   5               if(uptemp==100)
1444   5                {uptemp=0;}
1445   5      
1446   5      
1447   5           }
1448   4           } 
1449   3      
1450   3      
1451   3      
1452   3          if(dec==0)  
1453   3        {
1454   4           delay(10);
1455   4      
1456   4            
1457   4          if(dec==0)
1458   4          {
1459   5          while(!dec);                            
1460   5           uptemp--;
1461   5           num4[4]=uptemp;
1462   5           write_rvalue();
1463   5      
1464   5      
1465   5               if(uptemp==0)
1466   5                {uptemp=100;}
1467   5      
1468   5      
1469   5           }
1470   4           } 
1471   3      
1472   3      
1473   3       }
1474   2      
1475   2      
1476   2      
1477   2      
1478   2      
1479   2       
1480   2      
1481   2       //**************************以下烟雾度会上设定  和上面小时一样
C51 COMPILER V9.53.0.0   WINDOW_                                                           06/29/2017 22:59:53 PAGE 25  

1482   2       //只是就量不一样 不作注释*******************************************
1483   2       //**************       
1484   2       if(kval==17)
1485   2      
1486   2       {
1487   3         num4[4]=upsmo;
1488   3         write_rvalue();
1489   3        if(lofl==1)
1490   3        {
1491   4       write_com(0x80);
1492   4      
1493   4              for(num=0;num<16;num++)
1494   4          {
1495   5            write_date(logo15[num]);
1496   5            delay(2);
1497   5      
1498   5          
1499   5          }
1500   4      
1501   4      
1502   4      
1503   4           write_com(0x80+0x40);
1504   4      
1505   4              for(num=0;num<16;num++)
1506   4          {
1507   5            write_date(logo9[num]);
1508   5            delay(2);
1509   5      
1510   5            lofl=0;
1511   5          }
1512   4      
1513   4      
1514   4      }
1515   3      
1516   3      
1517   3           
1518   3      
1519   3          
1520   3      
1521   3      
1522   3      
1523   3      
1524   3          if(add==0)  
1525   3        {
1526   4           delay(10);
1527   4      
1528   4            
1529   4          if(add==0)
1530   4          {
1531   5          while(!add);                            
1532   5           upsmo++;
1533   5           num4[4]=upsmo;
1534   5           write_rvalue();
1535   5      
1536   5      
1537   5               if(upsmo==100)
1538   5                {upsmo=0;}
1539   5      
1540   5      
1541   5           }
1542   4           } 
1543   3      
C51 COMPILER V9.53.0.0   WINDOW_                                                           06/29/2017 22:59:53 PAGE 26  

1544   3      
1545   3      
1546   3          if(dec==0)  
1547   3        {
1548   4           delay(10);
1549   4      
1550   4            
1551   4          if(dec==0)
1552   4          {
1553   5          while(!dec);                            
1554   5           upsmo--;
1555   5           num4[4]=upsmo;
1556   5           write_rvalue();
1557   5      
1558   5      
1559   5               if(uptemp==0)
1560   5                {upsmo=100;}
1561   5      
1562   5      
1563   5           }
1564   4           } 
1565   3      
1566   3      
1567   3       }
1568   2      
1569   2      
1570   2      
1571   2      
1572   2      
1573   2      
1574   2      
1575   2      
1576   2      
1577   2      
1578   2      
1579   2      
1580   2       
1581   2      
1582   2      
1583   2         
1584   2       
1585   2       //*****退出设定*********   
1586   2      
1587   2      
1588   2        if(kval==18)
1589   2      
1590   2       {
1591   3      
1592   3      
1593   3      
1594   3        
1595   3         write_com(0x0c);
1596   3       
1597   3      
1598   3      kval=0;
1599   3        
1600   3      dsflj=1;
1601   3      lofl=1;
1602   3      keysw=1;
1603   3        if(lofl==1)
1604   3        {
1605   4       write_com(0x80);
C51 COMPILER V9.53.0.0   WINDOW_                                                           06/29/2017 22:59:53 PAGE 27  

1606   4      
1607   4              for(num=0;num<16;num++)
1608   4          {
1609   5            write_date(logo4[num]);//字幕显示
1610   5            delay(2);
1611   5          }
1612   4      
1613   4      
1614   4           write_com(0x80+0x40);
1615   4      
1616   4              for(num=0;num<16;num++)//字幕显示
1617   4          {
1618   5            write_date(logo3[num]);
1619   5            delay(2);
1620   5          }
1621   4      
1622   4      
1623   4      
1624   4      
1625   4           lofl=0;
1626   4      
1627   4          }
1628   3      
1629   3      
1630   3      
1631   3      
1632   3      
1633   3      
1634   3        }
1635   2      
1636   2      
1637   2      
1638   2      
1639   2      
1640   2       }
1641   1      
1642   1      
1643   1      
1644   1      
1645   1      
1646   1      
1647   1      
1648   1      
1649   1      
1650   1      
1651   1       }
1652          
1653          
1654            
1655          //步进电机函数
1656           void setmoto()
1657           {
1658   1        char num;
1659   1       //zhenfl fanfl
1660   1      
1661   1         if(zhenzhuan==1)  //正转
1662   1           {
1663   2           dsflj=0;
1664   2            SETP_MOTOR_REV();
1665   2           
1666   2          if(second==10)
1667   2          {
C51 COMPILER V9.53.0.0   WINDOW_                                                           06/29/2017 22:59:53 PAGE 28  

1668   3          zhenzhuan=0;
1669   3          P1=0X00;
1670   3          dsflj=1;
1671   3          opensw=0;
1672   3          closesw=1;
1673   3          keysw=1;
1674   3           menusw=1;
1675   3      
1676   3      
1677   3            zhenfl=1;
1678   3          fanfl=0;
1679   3          brigfl=0;
1680   3           humfl=0;
1681   3      
1682   3      
1683   3          write_com(0x80);
1684   3              for(num=0;num<16;num++)
1685   3          {              //字幕显示
1686   4            write_date(logo4[num]);
1687   4            delay(2);
1688   4          }
1689   3      
1690   3      
1691   3            write_com(0x80+0x40); //字幕显示
1692   3              for(num=0;num<16;num++)
1693   3          {
1694   4            write_date(logo3[num]);
1695   4            delay(2);
1696   4          }
1697   3      
1698   3      
1699   3      
1700   3          }
1701   2      
1702   2      
1703   2        
1704   2      
1705   2           }
1706   1        
1707   1            
1708   1      
1709   1          
1710   1           if(fanzhuan==1)  //反转
1711   1           { dsflj=0;
1712   2          
1713   2            SETP_MOTOR_FFW();
1714   2           
1715   2          if(second==10)
1716   2          { second=0;
1717   3              P1=0X00;
1718   3      
1719   3              zhenfl=0;
1720   3              fanfl=1;  
1721   3         
1722   3           fanzhuan=0;
1723   3           dsflj=1;
1724   3           
1725   3           dwbrigfl=0;
1726   3           brigfl=0;
1727   3      
1728   3      
1729   3          opensw=1;
C51 COMPILER V9.53.0.0   WINDOW_                                                           06/29/2017 22:59:53 PAGE 29  

1730   3          closesw=0;
1731   3          keysw=1;
1732   3          menusw=1;
1733   3            humfl=1;
1734   3          
1735   3              
1736   3      
1737   3          write_com(0x80);
1738   3      
1739   3              for(num=0;num<16;num++)  //字幕显示
1740   3          {
1741   4            write_date(logo4[num]);
1742   4            delay(2);
1743   4          }
1744   3      
1745   3              write_com(0x80+0x40);
1746   3              for(num=0;num<16;num++)
1747   3          {               //字幕显示
1748   4            write_date(logo3[num]);
1749   4            delay(2);
1750   4          }
1751   3      
1752   3      
1753   3           
1754   3          }
1755   2      
1756   2      
1757   2      
1758   2          
1759   2      
1760   2      
1761   2      
1762   2           }
1763   1          
1764   1       
1765   1       }
1766           
1767          void TEMPHRDSPLAY()       //显示空气温湿度函数   写入1602
1768          {  
1769   1          num1[4]=U8T_data_H;   //温度高8位，即是整数部分  
1770   1          num1[1]=num1[4]/10; //整数十位
1771   1          num1[0]=num1[4]%10; //整数个位
1772   1        
1773   1          write_com(0x80+0x40+7);        //显示温度
1774   1        write_date(0x30+num1[1]);
1775   1        write_date(0x30+num1[0]);
1776   1      
1777   1      
1778   1      
1779   1      
1780   1      
1781   1        num2[4]=U8RH_data_H;  //湿度高8位，即是整数部分  
1782   1          num2[3]=num2[4]/10; //整数十位
1783   1          num2[2]=num2[4]%10; //整数个位
1784   1      
1785   1          write_com(0x80+0x40+13);       //显示湿度
1786   1        write_date(0x30+num2[3]);
1787   1        write_date(0x30+num2[2]);
1788   1      
1789   1      } 
1790          
1791          
C51 COMPILER V9.53.0.0   WINDOW_                                                           06/29/2017 22:59:53 PAGE 30  

1792            
1793           
1794          
1795          
1796           
1797          void SMOGDSPLAY()       //显示空气温湿度函数   写入1602
1798          {  
1799   1          num3[4]=adc0;   //温度高8位，即是整数部分 
1800   1         
1801   1      
1802   1          
1803   1         
1804   1          num3[0]=num3[4]%10;         //显示ge位  
1805   1        num3[1]=num3[4]%100/10;   //显示shi位
1806   1        num3[2]=num3[4]%1000/100;//显示百位
1807   1        
1808   1          write_com(0x80+0X40+2);        
1809   1        write_date(0x30+num3[2]);
1810   1        write_date(0x30+num3[1]);
1811   1        write_date(0x30+num3[0]);
1812   1      
1813   1       }
1814          
1815            
1816          
1817          
1818          
1819          
1820          
1821          
1822          
1823          
1824          void BRDSPLAY() 
1825          {  
1826   1          
1827   1         
1828   1        num5[4]=adc1;   //温度高8位，即是整数部分 
1829   1          
1830   1         
1831   1          num5[0]=num5[4]%10;         //显示ge位  
1832   1        num5[1]=num5[4]%100/10;   //显示shi位
1833   1        num5[2]=num5[4]%1000/100;//显示百位
1834   1      
1835   1          write_com(0x80+3);      
1836   1        write_date(0x30+num5[2]);
1837   1        write_date(0x30+num5[1]);
1838   1        write_date(0x30+num5[0]);
1839   1      
1840   1        }
1841          
1842            
1843          
1844          void write_rvalue()
1845          
1846          {    
1847   1      
1848   1          
1849   1         
1850   1          num4[0]=num4[4]%10;         //显示ge位  
1851   1        num4[1]=num4[4]%100/10;   //显示shi位
1852   1        num4[2]=num4[4]%1000/100;//显示百位
1853   1      
C51 COMPILER V9.53.0.0   WINDOW_                                                           06/29/2017 22:59:53 PAGE 31  

1854   1      
1855   1      
1856   1          write_com(0x80+7);         //显示温度
1857   1        write_date(0x30+num4[2]);
1858   1        write_date(0x30+num4[1]);
1859   1        write_date(0x30+num4[0]);
1860   1       }
1861          
1862          
1863          
1864          
1865          
1866          
1867          
1868          void init()
1869          {
1870   1      
1871   1        TMOD=0X11;            //定时器设置
1872   1        TH0=0X3C;         //定时器0置初值 0.05S
1873   1        TL0=0XBA;
1874   1        EA=1;           //开总中断
1875   1        ET0=1;            //定时器0中断开启
1876   1        TR0=1;            //启动定时0
1877   1      
1878   1      
1879   1      
1880   1      
1881   1          TL1=0X3C;   //定时初值
1882   1        TH1=0XBA;   //定时初值
1883   1             //总中断打开
1884   1        TR1=1;     //启动定时器
1885   1        ET1=1;     //软件没用到
1886   1        
1887   1      
1888   1      
1889   1        RCAP2H =(0xFFFF-50000)/256;                //赋T2的预置值0x1000，溢出30次就是1秒钟
1890   1          RCAP2L =(0xFFFF-50000)%256;   
1891   1          TR2=1;                       //启动定时器
1892   1          ET2=1;   
1893   1      
1894   1      
1895   1          IT1=1;
1896   1        TH0=0;  //定时器0初值
1897   1        TL0=0;  //定时器0初值
1898   1          TR0=1;  //定时器0启动    
1899   1        EX1=1;  //外部中断 软件没用到
1900   1      
1901   1      
1902   1        
1903   1      }
1904          
1905          
1906          
1907          void main()//主函数
1908          {
1909   1        init();
1910   1        init1602();
1911   1      
1912   1        sudu=200; //电要速度
1913   1        zhenzhuan=0;//上电关正转
1914   1        fanzhuan=1;//上电反转打开
1915   1        dsflj=1;
C51 COMPILER V9.53.0.0   WINDOW_                                                           06/29/2017 22:59:53 PAGE 32  

1916   1            // 显示打开
1917   1      
1918   1        uptemp=38; //温度上限
1919   1        uphum=80;  //湿度上限
1920   1      
1921   1      
1922   1        upbrig=120; // 光控值
1923   1      
1924   1        dwbrig=10;//光控下限
1925   1        kwbrig=180;
1926   1        upsmo=85;
1927   1      
1928   1        opensw=1;
1929   1        closesw=1;
1930   1        keysw=1;
1931   1        menusw=1;
1932   1        second=0;
1933   1       
1934   1                zhenfl=0;
1935   1              fanfl=0;
1936   1      
1937   1      
1938   1            brigfl=1;
1939   1            dwbrigfl=1;
1940   1            humfl=0;
1941   1      
1942   1       adc0 = ADC0832(1,0);  //差分模式，CH0-CH1
1943   1       adc1 = ADC0832(1,1);  //差分模式，CH0-CH1
1944   1      
1945   1      
1946   1      
1947   1      
1948   1       hour=12;
1949   1       minit=5;
1950   1       secon=10; // 系统时间    这些值可以按键修改
1951   1      
1952   1      
1953   1      ONhour=12;  // 自动开窗时间  为了方便演示 设定 一分钟后开 这些值可以按键修改
1954   1      ONminit=6;
1955   1      ONsecon=10;
1956   1      
1957   1      
1958   1      OFhour=12;  // 自动关窗时间 为了方便演示 设定 一分钟后关 这些值可以按键修改
1959   1      OFminit=7;
1960   1      OFsecon=10;
1961   1      
1962   1      
1963   1      
1964   1        while(1)//大循环
1965   1      
1966   1        {
1967   2        
1968   2         
1969   2      
1970   2      
1971   2         
1972   2         
1973   2            
1974   2      
1975   2      keyscn();
1976   2      setmoto();
1977   2      
C51 COMPILER V9.53.0.0   WINDOW_                                                           06/29/2017 22:59:53 PAGE 33  

1978   2      
1979   2      
1980   2      if (dsflj==1 )
1981   2      {
1982   3      
1983   3       //get_temp(); //SHT10调用
1984   3      //cal_wet();//SHT10调用
1985   3      
1986   3      RH(); //DHT11 调用
1987   3         
1988   3       //  U8T_data_H= SENSOR[k].temp;//SHT10调用
1989   3       //  U8RH_data_H=SENSOR[k].wet;//SHT10调用   
1990   3         
1991   3         
1992   3      TEMPHRDSPLAY(); 
1993   3      
1994   3      
1995   3      
1996   3       
1997   3      
1998   3       
1999   3      
2000   3      
2001   3      
2002   3      
2003   3       
2004   3      adc0 = ADC0832(1,0);  //差分模式，CH0-CH1 
2005   3      SMOGDSPLAY();
2006   3      
2007   3      adc1 = ADC0832(1,1);  //差分模式，CH0-CH1
2008   3      BRDSPLAY(); 
2009   3       
2010   3      
2011   3      
2012   3      
2013   3      
2014   3      
2015   3      
2016   3      
2017   3        if(fanfl==1)
2018   3        {
2019   4      
2020   4      
2021   4           if(adc1> kwbrig )//如果际亮度小与设定值 关窗
2022   4       {
2023   5      
2024   5        zhenzhuan=1;
2025   5      
2026   5      
2027   5      } 
2028   4         
2029   4         
2030   4         
2031   4         
2032   4         
2033   4           
2034   4         if(Im[2]==0x40)
2035   4         
2036   4      {
2037   5       Im[2]=0x00;
2038   5      zhenzhuan=1;
2039   5      
C51 COMPILER V9.53.0.0   WINDOW_                                                           06/29/2017 22:59:53 PAGE 34  

2040   5      }
2041   4      
2042   4      
2043   4      
2044   4      
2045   4         second=0;
2046   4      
2047   4       if(U8T_data_H>uptemp )//如果际温度大与设定值 开窗
2048   4       {
2049   5      
2050   5       zhenzhuan=1;
2051   5       
2052   5       }
2053   4       
2054   4      
2055   4      
2056   4       if(adc0>upsmo )//如果际温度大与设定值 开窗
2057   4       {
2058   5      
2059   5       zhenzhuan=1;
2060   5       
2061   5       }
2062   4      
2063   4      
2064   4        
2065   4      
2066   4      
2067   4      
2068   4      
2069   4      
2070   4      
2071   4      
2072   4      
2073   4      
2074   4      
2075   4      
2076   4      
2077   4      
2078   4      }
2079   3      
2080   3        if(zhenfl==1)
2081   3        {
2082   4      
2083   4           if(Im[2]==0x44)
2084   4         
2085   4      {
2086   5      Im[2]=0x00;
2087   5      fanzhuan=1;
2088   5      
2089   5      }
2090   4      
2091   4      
2092   4        second=0;
2093   4       if(U8RH_data_H>uphum )//如果际湿度大与设定值 关窗
2094   4       {
2095   5      
2096   5       fanzhuan=1;
2097   5        brigfl=0;
2098   5        dwbrigfl=0;
2099   5        
2100   5        }
2101   4      
C51 COMPILER V9.53.0.0   WINDOW_                                                           06/29/2017 22:59:53 PAGE 35  

2102   4      
2103   4          if(adc1<dwbrig )//如果际亮度小与设定值 关窗
2104   4       {
2105   5      
2106   5      
2107   5      fanzhuan=1;
2108   5      }
2109   4        
2110   4      
2111   4      
2112   4      
2113   4      
2114   4      
2115   4        
2116   4      
2117   4      
2118   4       
2119   4      if(IR==0) 
2120   4        {
2121   5           delay(10);
2122   5      
2123   5            
2124   5          if(IR==0)
2125   5          {
2126   6          //while(!IR); 
2127   6            befl=1;
2128   6             ET2=1; 
2129   6            fanzhuan=1;
2130   6            con=0;
2131   6                                    
2132   6           } 
2133   5      
2134   5            
2135   5      
2136   5      
2137   5           }
2138   4      
2139   4      
2140   4      
2141   4      
2142   4       
2143   4      
2144   4      
2145   4      
2146   4        
2147   4      
2148   4      
2149   4      }
2150   3      
2151   3      
2152   3      
2153   3      
2154   3       
2155   3      
2156   3      
2157   3       
2158   3            if(dec==0)  
2159   3        {
2160   4           delay(10);
2161   4      
2162   4            
2163   4          if(dec==0)
C51 COMPILER V9.53.0.0   WINDOW_                                                           06/29/2017 22:59:53 PAGE 36  

2164   4          {
2165   5          while(!dec);                            
2166   5           befl=0;
2167   5           BEEP=1; 
2168   5            
2169   5      
2170   5           } 
2171   4      
2172   4      
2173   4           }
2174   3         
2175   3      
2176   3      
2177   3                
2178   3          
2179   3      
2180   3      
2181   3      
2182   3      
2183   3      
2184   3      
2185   3      
2186   3              DSdat=secon;
2187   3          write_com(0x80+14);
2188   3          write_sfm();
2189   3      
2190   3          DSdat=minit;
2191   3            write_com(0x80+11);
2192   3            write_sfm();
2193   3      
2194   3          DSdat=hour;
2195   3              write_com(0x80+0x08);
2196   3          write_sfm();
2197   3      
2198   3      
2199   3      
2200   3      
2201   3      
2202   3      
2203   3      
2204   3      
2205   3      
2206   3      
2207   3      
2208   3      
2209   3      
2210   3      
2211   3      }
2212   2      
2213   2      
2214   2      }
2215   1      
2216   1      
2217   1      }
2218           
2219          
2220          
2221          
2222          
2223          
2224          
2225          
C51 COMPILER V9.53.0.0   WINDOW_                                                           06/29/2017 22:59:53 PAGE 37  

2226           
2227          //定时器2中断
2228          timer2() interrupt 5 
2229          {
2230   1          TF2=0; //!!!注意!!! 定时器2必须由软件对溢出标志位清零，硬件不能清零，这里与定时器0和定时器1不同!!!
2231   1       
2232   1      
2233   1        count0++;
2234   1        con++;
2235   1      
2236   1          if(count0==15)
2237   1          {
2238   2          count0=0;
2239   2            second++;
2240   2        } 
2241   1          
2242   1            
2243   1          
2244   1           if(befl==1)
2245   1         {
2246   2          if(con==20)
2247   2          {
2248   3          con=0;
2249   3            BEEP=~BEEP;
2250   3          
2251   3          
2252   3            
2253   3        } 
2254   2          
2255   2        }
2256   1       
2257   1          
2258   1      
2259   1      
2260   1      
2261   1      }
2262             
2263          
2264          
2265          
2266            void time0(void) interrupt 1 using 1    //定时中断子程序
2267          {
2268   1        TH0=0X3C;             //重赋初值
2269   1        TL0=0XBA;
2270   1      
2271   1        
2272   1      
2273   1      
2274   1      
2275   1      
2276   1      }
2277          
2278          
2279          
2280          
2281          
2282            //*********************************中断服务函数**************************************
2283          void  time0_int(void) interrupt 3 
2284          {
2285   1      
2286   1        
2287   1        TH0=0X3C;             //重赋初值
C51 COMPILER V9.53.0.0   WINDOW_                                                           06/29/2017 22:59:53 PAGE 38  

2288   1        TL0=0XBA;   //定时初值
2289   1        TR1=1;
2290   1        time++;
2291   1       
2292   1             
2293   1          if(time==20)
2294   1          {
2295   2          time=0;
2296   2            secon++;  
2297   2            
2298   2            
2299   2           
2300   2      
2301   2      
2302   2        }
2303   1        
2304   1          
2305   1            if(secon==60)
2306   1          {
2307   2          secon=0;
2308   2            minit++;
2309   2        
2310   2            
2311   2            
2312   2        } 
2313   1          
2314   1          
2315   1        if(minit==60)
2316   1          {
2317   2          minit=0;
2318   2            hour++; 
2319   2            if(hour==24)
2320   2          {
2321   3          hour=0;
2322   3          } 
2323   2      
2324   2          
2325   2          
2326   2      
2327   2            
2328   2        } 
2329   1      
2330   1      
2331   1        
2332   1      
2333   1      
2334   1      
2335   1      
2336   1      
2337   1      
2338   1       
2339   1          if(fanfl==1)
2340   1        {
2341   2      
2342   2       
2343   2      
2344   2      
2345   2      
2346   2        if((ONhour==hour)&&(ONminit==minit)&&(ONsecon==secon))//定时开窗
2347   2        {
2348   3            
2349   3      
C51 COMPILER V9.53.0.0   WINDOW_                                                           06/29/2017 22:59:53 PAGE 39  

2350   3      
2351   3       zhenzhuan=1;
2352   3      
2353   3       }
2354   2           
2355   2      }
2356   1      
2357   1      
2358   1      
2359   1      
2360   1      
2361   1      
2362   1        if(zhenfl==1)
2363   1        {
2364   2      
2365   2      
2366   2      
2367   2        if((hour==OFhour)&&(minit==OFminit)&&(secon==OFsecon)) //定时关窗
2368   2        {
2369   3            
2370   3      
2371   3      
2372   3       fanzhuan=1;
2373   3      
2374   3      
2375   3      
2376   3      
2377   3      }
2378   2        
2379   2      
2380   2      }
2381   1      
2382   1      
2383   1      
2384   1      
2385   1      
2386   1      
2387   1      
2388   1      
2389   1      
2390   1      
2391   1      
2392   1      
2393   1       
2394   1      
2395   1      
2396   1      
2397   1      
2398   1      
2399   1      
2400   1      }
2401          
2402          
2403          
2404          
2405          //*********************************中断服务函数**************************************
2406          // 遥控 解码 函数 接收头 接外部 中断口 P3.3
2407          /************************************************************************/  
2408          //外部中断解码程序
2409          void intersvr1(void) interrupt 2 using 1
2410          {
2411   1          Tc=TH0*256+TL0; //定时器清空只记TC 值                                              //提取中断时间间隔
C51 COMPILER V9.53.0.0   WINDOW_                                                           06/29/2017 22:59:53 PAGE 40  

             -背
2412   1          TH0=0; 
2413   1          TL0=0;              //定时中断重新置零
2414   1      
2415   1        if((Tc>Imin)&&(Tc<Imax))//启动码判定 两个时间对比0.9MS  
2416   1        {  
2417   2              m=0;
2418   2              f=1;
2419   2              return;
2420   2        }       //找到启始码
2421   1        
2422   1        if(f==1)
2423   1        {
2424   2              if(Tc>Inum1&&Tc<Inum3) //判定是0该还是1 是0 1.125MS 是1  2.25MS
2425   2          {
2426   3            Im[m/8]=Im[m/8]>>1|0x80; m++;  //存0
2427   3          }
2428   2          if(Tc>Inum2&&Tc<Inum1) 
2429   2              {
2430   3            Im[m/8]=Im[m/8]>>1; m++; // 存1
2431   3          }
2432   2          if(m==32)   //32位存储完毕
2433   2          {
2434   3            m=0;  
2435   3            f=0;
2436   3            if(Im[2]==~Im[3])  //反码检查
2437   3            {  
2438   4              IrOK=1;   //OK 完成
2439   4            }
2440   3            else IrOK=0;   //取码完成后判断读码是否正确
2441   3          }
2442   2          //准备读下一码
2443   2        }
2444   1        
2445   1      }
2446          /************************************************************************/
2447          //************zheng 0X45; stop  0X46; fan  0X47   aut  0X43;
2448          
2449          
2450          
2451          
2452          
2453          
2454          
2455          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   4576    ----
   CONSTANT SIZE    =    293    ----
   XDATA SIZE       =     40    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     93       2
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       2
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
